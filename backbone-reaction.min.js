/*!
 * https://github.com/jhudson8/backbone-reaction v0.9.2;  MIT license; Joe Hudson<joehud_AT_gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["react","backbone","underscore"],e):"undefined"!=typeof exports&&"undefined"!=typeof require?module.exports=function(t,n){e(t,n,require("underscore"))}:e(React,Backbone,_)}(function(React,Backbone,_){!function(){var e=Backbone.sync;Backbone.async=_.extend({},Backbone.Events),Backbone.sync=function(t,n,i){function a(e){var t=i[e];i[e]=function(){var a=arguments;t&&t.apply(this,a);var o=r.indexOf(s);o>=0&&r.splice(o,1);var c="success"===e?[e,n,i]:[e,n,a[1],a[2],i];s.trigger.apply(s,c),c.splice(0,0,"complete"),s.trigger.apply(s,c),0===r.length&&n.trigger("async:load-complete")}}i=i||{},i.url||(i.url=_.result(n,"url"));var r=n._pendingAsyncEvents=n._pendingAsyncEvents||[],o=i&&i.event||t,s=_.extend({},Backbone.Events);r.push(s),s.method=t,s.options=i,s.model=n,n.trigger("async",o,s,i),n.trigger("async:"+o,s,i),_.each([Backbone.async,Backbone.asyncHandler],function(e){e&&(e.trigger("async",o,n,s,i),e.trigger("async:"+o,n,s,i))}),a("success"),a("error");var c=i.intercept;if(c){if("function"==typeof c)return c(i);throw"intercept must be function(options)"}e.call(this,t,n,i)},_.each([Backbone.Model,Backbone.Collection],function(e){e.prototype.isLoading=function(){return this._pendingAsyncEvents&&this._pendingAsyncEvents.length>0?this._pendingAsyncEvents:!1}}),Backbone.async.on("async:read",function(e,t){t.on("success",function(){e.hasBeenFetched=!0,e.hadFetchError=!1}),t.on("error",function(){e.hadFetchError=!0})})}(),function(){function get(values,index,initiatedOnce,rtn){function addTo(name){var indexName=name,match=name.match(/^([^\(]*)\s*\(([^\)]*)\)\s*/),params=match&&match[2];if(name=match&&match[1]||name,!index[indexName]){params&&(params=eval("["+params+"]"));var mixin=React.mixins._mixins[name],checkAgain=!1,skip=!1;if(!mixin)throw new Error('invalid mixin "'+name+'"');if("function"==typeof mixin)React.mixins._initiatedOnce[name]?(initiatedOnce[name]=initiatedOnce[name]||[],initiatedOnce[name].push(params),skip=!0):(mixin=mixin.apply(this,params||[]),checkAgain=!0);else if(params)throw new Error('the mixin "'+name+'" does not support parameters');get(React.mixins._dependsOn[name],index,initiatedOnce,rtn),get(React.mixins._dependsInjected[name],index,initiatedOnce,rtn),index[indexName]=!0,checkAgain?get([mixin],index,initiatedOnce,rtn):skip||rtn.push(mixin)}}function handleMixin(e){e&&(Array.isArray(e)?get(e,index,initiatedOnce,rtn):"string"==typeof e?addTo(e):rtn.push(e))}if(Array.isArray(values))for(var i=0;i<values.length;i++)handleMixin(values[i]);else handleMixin(values)}function getInitiatedOnce(e,t){function n(e,n){e=e.apply(this,n||[]),t.push(e)}for(var i in e)e.hasOwnProperty(i)&&n(React.mixins._mixins[i],e[i])}function addMixin(e,t,n,i,a){var r=React.mixins;(i||!r._mixins[e])&&(r._dependsOn[e]=n.length&&n,r._mixins[e]=t,a&&(r._initiatedOnce[e]=!0))}function GROUP(){}function mixinParams(e,t){var n,i=e[0],a=!1;if("object"==typeof i?(n=i.name,a=i.initiatedOnce):n=i,!n||!n.length)throw new Error("the mixin name hasn't been specified");return Array.isArray(e[1])?[n,e[1][0],Array.prototype.slice.call(e[1],1),t,a]:[n,e[1],Array.prototype.slice.call(e,2),t,a]}var _createClass=React.createClass;React.createClass=function(e){return e.mixins&&(e.mixins=React.mixins.get(e.mixins)),_createClass.apply(React,arguments)},React.mixins={get:function(){var e=[],t={},n={};return get(Array.prototype.slice.call(arguments),t,n,e),getInitiatedOnce(n,e),e},inject:function(e){var t=this._dependsInjected[e];t||(t=this._dependsInjected[e]=[]),t.push(Array.prototype.slice.call(arguments,1))},alias:function(e){addMixin(e,GROUP,Array.prototype.slice.call(arguments,1),!1)},add:function(){addMixin.apply(this,mixinParams(arguments,!1))},replace:function(){addMixin.apply(this,mixinParams(arguments,!0))},exists:function(e){return this._mixins[e]||!1},_dependsOn:{},_dependsInjected:{},_mixins:{},_initiatedOnce:{}},React.mixins.add("deferUpdate",{getInitialState:function(){return{}},deferUpdate:function(){var e=this.state;if(!e._deferUpdate){e._deferUpdate=!0;var t=this;setTimeout(function(){delete e._deferUpdate,t.isMounted()&&t.forceUpdate()},0)}}})}(),function(){function e(o,s,c,d){if(!d){var l,u=s;if("object"==typeof s&&(u=s.callback.call(this)),"string"==typeof s&&(l=r.indexOf(s)>=0,u=c[s]),!u)throw'no callback function exists for "'+s+'"';s=function(){return u.apply(c,l?[]:arguments)}}var f=o.match(a);if(f){var h=f[1],m=f[2].split(/\s*,\s*/),p=f[3],v=React.events.specials[h];if(v)return 1===m.length&&""===m[0]&&(m=[]),s=v.call(c,s,m),e(p,s,c,!0);throw new Error('invalid special event handler "'+h+"'")}var g=o.match(i),x=g[1];path=g[2],handler=t[x];for(var _=0;!handler&&_<n.length;_++)x.match(n[_].pattern)&&(handler=n[_].handler);if(!handler)throw'no handler registered for "'+o+'"';return handler.call(c,{key:x,path:path},s)}var t={},n=[],i=/^([^:]+):?(.*)/,a=/^\*([^\(]+)\(([^)]*)\):(.*)/,r=["forceUpdate"],o={standard:function(e){var t={on:e.onKey||"on",off:e.offKey||"off"},n=e.target;return function(i,a){function r(e,i){return function(){var r="function"==typeof n?n.call(i,o):n;r&&r[t[e]](o,a)}}var o=i.path;return{on:r("on",this),off:r("off",this),initialize:e.initialize}}}},s=React.events={specials:{},handle:function(e,i){"function"!=typeof i&&(i=o[i.type||"standard"](i)),e instanceof RegExp?n.push({pattern:e,handler:i}):t[e]=i}};"undefined"!=typeof window&&s.handle("window",{target:window,onKey:"addEventListener",offKey:"removeEventListener"}),s.handle("ref",function(e,t){var n,a,r=e.path.match(i),o=r[1],s=r[2];return{on:function(){var e=this.refs[o];e&&(a=e.state||e,e.on(s,t),n=e)},off:function(){n&&(n.off(s,t),n=void 0,a=void 0)},isStale:function(){if(!n)return!!this.refs[o];var e=this.refs[o];return e&&(e.state||e)===a?void 0:!0}}}),s.handle("dom",function(e,t){var n=e.path.match(i);return{on:function(){$(this.getDOMNode()).on(n[1],n[2],t)},off:function(){$(this.getDOMNode()).off(n[1],n[2],t)}}}),s.handle("repeat",function(e,t){var n,i=parseInt(e.path,10);return{on:function(){n=setInterval(t,i)},off:function(){n=!!clearInterval(n)}}}),s.handle("!repeat",function(e,t){function n(e){e!==!0&&t(),setTimeout(function(){i&&requestAnimationFrame(n)},a)}var i,a=parseInt(e.path,10);return{on:function(){i=!0,n(!0)},off:function(){i=!1}}}),React.mixins.add("events",function(){function t(e,t){return function(){e.apply(t,arguments)}}var n=[{triggerWith:function(){var e=Array.prototype.slice.call(arguments),t=this;return function(){t.trigger.apply(this,e)}},getInitialState:function(){var t=this._eventHandlers=[];if(this.events){var n;for(var i in this.events)n=e(i,this.events[i],this),n.initialize&&n.initialize.call(this),t.push(n)}return null},componentDidUpdate:function(){for(var e,t=this._eventHandlers,n=0;n<t.length;n++)e=t[n],e.isStale&&e.isStale.call(this)&&(e.off.call(this),e.on.call(this))},componentDidMount:function(){for(var e=this._eventHandlers,t=0;t<e.length;t++)e[t].on.call(this)},componentWillUnmount:function(){for(var e=this._eventHandlers,t=0;t<e.length;t++)e[t].off.call(this)}}];if(s.mixin){var i={},a={};for(var r in s.mixin)i[r]=t(s.mixin[r],a);i.getInitialState=function(){return{__events:a}},n.push(i)}return n})}(),function(){function e(e,t){t.isMounted()?t.setState(e):t.state?_.extend(t.state,e):t.__react_backbone_state=_.extend(t.__react_backbone_state||{},e)}function t(e,t){var n=t.state,i=t.__react_backbone_state;return n&&n[e]||i&&i[e]}function n(e){return e?_.isArray(e)?e:[e]:void 0}function i(e){return e.props.key||e.props.ref}function a(e,t,i,a){var r,o,s=Array.isArray(e)?e:n(t.props[e]);if(s){for(var c=0;c<s.length;c++)r=s[c],o=i.replace("{key}",r),t.modelOn(o,_.bind(a,t),this);return s}}function r(n,i){i=_.extend({type:n},i);var a=t("__modelEvents",this);if(a||(a=[],e({__modelEvents:a},this)),i.context=i.context||this,a.push(i),this.isMounted()){var r=i.model||this.getModel();r&&r[i.type](i.event,i.callback,i.context)}}function o(e){for(var t,n=0;n<e.length;n++)t=e[n],"true"===t?t=!0:"false"===t?t=!1:t.match(/^[0-9]+$/)?t=parseInt(t):t.match(/^[0-9]+\.[0-9]+/)&&(t=parseFloat(t)),e[n]=t;return e}if(React.mixins.add("modelAware",{componentWillMount:function(){var e=this.__react_backbone_state;e&&(this.state=_.extend(this.state||{},e),delete this.__react_backbone_state)},getModel:function(){return t("model",this)||t("collection",this)||this.props.model||this.props.collection},setModel:function(t){this._modelUnbindAll&&this._modelUnbindAll(!0),e({model:t},this),this._modelBindAll&&this.isMounted()&&this._modelBindAll()}}),React.mixins.add("modelValueAware",function(e){return{getModelValue:function(){e=e||i(this);var t=this.getModel();return t&&e?t.get(e):void 0},setModelValue:function(t,n){e=e||i(this);var a=this.getModel();return a=this.getModel(),a&&e?a.set(e,t,n):void 0}}},"modelAware"),React.mixins.add("modelPopulate",{modelPopulate:function(e,t,n){_.isFunction(e)&&(n=t,t=e,e=void 0);var a={};if(e||(e=_.map(this.refs,function(e){return e})),_.each(e,function(e){if(e.getUIModelValue){var t=i(e),n=e.getUIModelValue();a[t]=n}}),t&&this.getModel){var r=this.getModel();r&&r.set(a,n||{validate:!0})&&t.call(this,r)}return a}},"modelAware"),React.mixins.add("modelValidator",{modelValidate:function(e,t){var n=this.getModel();return n&&n.validate?this.modelIndexErrors(n.validate(e,t))||!1:void 0}},"modelAware","modelIndexErrors"),React.mixins.add("modelEventAware",{getInitialState:function(){return{}},modelOn:function(e,t){var n=t?{event:e,callback:t}:e;r.call(this,"on",n)},modelOnce:function(e,t){var n=t?{event:e,callback:t}:e;r.call(this,"once",n)},modelOff:function(e,t){var n=t?{event:e,callback:t}:e,i=this.state.__modelEvents;if(i)for(var a,r=0;r<i.length;r++)if(a=i[r],a.event===n.event&&a.model===n.model&&a.callback===n.callback){var o=n.model||this.getModel();o&&o.off(n.event,n.callback,n.context||this),i.splice(r,1)}},_modelBindAll:function(){var e=t("__modelEvents",this);if(e){var n=this.getModel();_.each(e,function(e){var t=e.model||n;t&&t[e.type](e.event,e.callback,e.context)})}},_modelUnbindAll:function(n){var i=t("__modelEvents",this);if(i){var a=this.getModel();_.each(i,function(e){var t=e.model||a;t&&t.off(e.event,e.callback,e.context)}),n||e({__modelEvents:[]},this)}},componentDidMount:function(){this._modelUnbindAll(!0),this._modelBindAll(!0)},componentWillUnmount:function(){this._modelUnbindAll(!0)}},"modelAware"),React.mixins.add("modelChangeAware",{getInitialState:function(){return _.each(["change","reset","add","remove","sort"],function(e){this.modelOn(e,function(){this.deferUpdate()})},this),null}},"modelEventAware","deferUpdate"),React.mixins.add("modelAsyncAware",{getInitialState:function(){this.modelOn("async",function(t,n){e({loading:!0},this);var i=this.getModel();n.on("success",function(){e({loading:!!i.isLoading()},this)},this),n.on("error",function(t){e({loading:!!i.isLoading(),error:t},this)},this)});var t=this.getModel();return t&&t.isLoading()?{loading:!0}:{}},componentDidMount:function(){var t=this.state,n=this.getModel();n&&(n.isLoading()?(this.modelOnce("async:load-complete",function(){e({loading:!1},this)}),t.loading||e({loading:!0},this)):t.loading&&e({loading:!1},this))}},"modelEventAware"),React.mixins.add("modelInvalidAware",{getInitialState:function(){var t=i(this);return t&&this.modelOn("invalid",function(n,i){i=this.modelIndexErrors(i)||{};var a=i[t];a&&e({error:a},this)}),{}}},"modelIndexErrors","modelEventAware"),React.mixins.add("modelIndexErrors",{modelIndexErrors:function(e){if(Array.isArray(e)){var t={};return _.each(e,function(e){for(var n in e)t[n]=e[n]}),t}return e}}),React.mixins.add("modelLoadOn",function(){var t=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){t=a(t||"loadOn",this,"async:{key}",function(t){e({loading:!0},this),t.on("complete",function(){e({loading:!1},this)},this)});var n=this.getModel();if(n){var i,r=n.isLoading();if(r)for(var o=function(){e({loading:!1},this)},s=0;s<r.length;s++){var c=t.indexOf(r[s].method);if(c>=0)return i=t[c],r[s].on("complete",o,this),{loading:!0}}}return{}},loadWhile:function(t){function n(n){var a=t[n];t[n]=function(){e({loading:!1},i),a&&a.apply(this,arguments)}}t=t||{};var i=this;return n("error"),n("success"),e({loading:!0},this),t}}},"modelEventAware"),React.mixins.add("modelUpdateOn",function(){var e=arguments.length>0?Array.prototype.slice.call(arguments,0):void 0;return{getInitialState:function(){a(e||"updateOn",this,"{key}",function(){this.deferUpdate()})}}},"modelEventAware","deferUpdate"),React.events){React.events.mixin=React.events.mixin||Backbone.Events;var s=/^model(\[.+\])?$/;React.events.handle(s,function(e,t){var n=e.key.match(s),i=n[1]&&n[1].substring(1,n[1].length-1),a=i&&(this.props[i]||this.refs[i]);if(!a&&i)throw new Error('no model found with "'+i+'"');var r={model:a,event:e.path,callback:t};return{on:function(){this.modelOn(r)},off:function(){}}});var c=React.events.specials;if(c){var d=["memoize","delay","defer","throttle","debounce","once"];_.each(d,function(e){c[e]=c[e]||function(t,n){return n=o(n),n.splice(0,0,t),_[e].apply(_,n)}})}}var l=function(e,t,n,i){return React.createClass(_.extend({mixins:["modelValueAware"],render:function(){var i={},a=this.getModelValue();return n?i.defaultChecked=a:i.defaultValue=a,React.DOM[e](_.extend(i,t,this.props),this.props.children)},getUIModelValue:function(){if(this.isMounted()){if(!n)return $(this.getDOMNode()).val();var e=this.getDOMNode();if(e.checked)return e.value||!0}}},i))};Backbone.input=Backbone.input||{},_.defaults(Backbone.input,{Text:l("input",{type:"text"}),TextArea:l("textarea"),Select:l("select",void 0,void 0),CheckBox:l("input",{type:"checkbox"},!0),RadioGroup:React.createClass({mixins:["modelValueAware"],render:function(){var e=this.props;return React.DOM[e.tag||"span"](e,e.children)},componentDidMount:function(){var e=this.getModelValue();if(e){var t='input[value="'+e.replace('"','\\"')+'"]',n=$(this.getDOMNode()).find(t);n.attr("checked","checked")}},getUIModelValue:function(){if(this.isMounted())for(var e='input[type="radio"]',t=$(this.getDOMNode()).find(e),n=0;n<t.length;n++)if(t[n].checked)return t[n].value}})})}()});